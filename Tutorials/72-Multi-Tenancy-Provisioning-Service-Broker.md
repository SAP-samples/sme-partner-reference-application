# Configure and Consume the APIs of the BTP Application

In earlier steps [Enhance the BTP Application by a Service Broker](../Tutorials/71-Multi-Tenancy-Service-Broker.md) the service broker is available as part of application deployed in the provider BTP subaccount.

The service broker is used to enable access to application OData services using tenant-specific credentials and authorizations taking into account the tenant isolation in an multi-tenant application. 

In this tutorial we describe the steps to configure and consume the APIs of the BTP application in the consumer BTP subaccount.

## Service Broker configuration in an subscriber BTP subaccount involves following steps:

BTP Cockpit - consumer subaccount:

1. Activate Cloud Foundry (without quota)
    - Open the consumer subaccount.
    - Create an instance of Cloud Foundry without quota.
        > Note: Cloud Foundry instance is required to run the cloud foundry commands for the creation of service broker instance (as shown in next steps) and user should have administrative permissions with access to Cloud Foundry space to run service broker related commands.    
    - Provide a user with administrative permissions, with access to *Cloud Foundry org member* and *Cloud Foundry space member*.

Business Application Studio:

2. Create a service broker instance
    - Login to the Cloud Foundry space of the consumer subaccount (command `cf login`).
    - Create a service broker instance using the following command
    `cf create-service-broker <BrokerName> <BrokerUser> <plain-broker-password> <Broker-URL> --space-scoped` (example: `cf create-service-broker author-readings-api brokeruser e5jS3jVzchJK3b8cRR88R3CW0qMaFK7V https://armt-runtime-author-readings-servicebroker.cfapps.eu10.hana.ondemand.com --space-scoped`

        > Note: *BrokerUser* and *BrokerPassword* is generated in the earlier chapter [Enhance the BTP Application by a Service Broker](../Tutorials/71-Multi-Tenancy-Service-Broker.md); replace *plain-broker-password* with the plaintext password generated by hash-broker-password script.
        
        > Note: you delete the service broker instance using the command `cf delete-service-broker <BrokerName>`.

        > Note: Space scoped brokers are registered to a specific space, and all users within that space can access the brokerâ€™s service plans. With space-scoped brokers, service visibility is not managed separately.

        > Note: BrokerName is an arbitrary name used to distinguish the service broker from the rest. It is independent from the broker application name.

BTP Cockpit - consumer subaccount:

3. Open the CF space and navigate to the CF space *Service Marketspace*: Create instance of the *Author Readings API*-service.

4. Open the *Instances and Subscriptions* and create a *Service Key* for the new service broker instance
        - Click on *Create* button in the *Service Keys* section
        - Enter arbitary *Service Key Name* (e.g. "api-key")
        - Click on *Create* button
        - Click on the above created *Service Key*, copy the details *clientid*, *clientsecret*, *url*, *apiurl* , the details are used in next step to call the APIs from consumer application like Postman.

5. Access the service from Postman
