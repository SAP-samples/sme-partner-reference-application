# Configure and Consume the APIs of the BTP Application
In earlier steps [Enhance the BTP Application by a Service Broker](../Tutorials/71-Multi-Tenancy-Service-Broker.md) the service broker is available as part of application deployed in provider BTP subaccount.

Service broker is used to enable access to application OData services using tenant specific credentials and authorizations taking into account the tenant isolation in an multi-tenant application. as a next step configure and cosume the APIs of the BTP application in subscriber BTP subaccount.

Service Broker configuration in an subscriber BTP subaccount involves following steps:

1. Create instance and Register the service broker
    - Open the subscriber subaccount
    - Create an instance of Cloud Foundry without quota
    - Provide user with access *Cloud Foundry org member* and *Cloud Foundry space member*
    > Note: Cloud Foundry instance is required to run the service broker instance creation cloud foundry commands (as shown in next steps) and user should have administrative permissions with access to Cloud Foundry space to run service broker related commands
    - Sample cloud foundry command to crete service broker instance
    `cf create-service-broker <BrokerName> <BrokerUser> <plain-broker-password>  <Broker-URL> --space-scoped`
    - Example command : `cf create-service-broker author-readings-servicebroker brokeruser e5jS3jVzchJK3b8cRR88R3CW0qMaFK7V https://armt-runtime-author-readings-servicebroker.cfapps.eu10.hana.ondemand.com --space-scoped`
    > Note: BrokerUser and BrokerPassword is generated in the earlier chapter [Enhance the BTP Application by a Service Broker](../Tutorials/71-Multi-Tenancy-Service-Broker.md) , Replace *plain-broker-password* with the plaintext password generated by hash-broker-password script.
    > Note: You can get the broker URL via the command cf apps. Broker-URL is a combination of SubDomainProviderSubAccount-BrokerName-DomainSubscriberSubAccount , sample broker url: `https://armt-runtime-author-readings-servicebroker.cfapps.eu10.hana.ondemand.com` 
    > Note: Space scoped brokers are registered to a specific space, and all users within that space can access the brokerâ€™s service plans. With space-scoped brokers, service visibility is not managed separately.
    > Note: BrokerName is an arbitrary name used to distinguish the service broker from the rest. It is independent from the broker application name.
2. View the service broker
    - Now you can use your service broker within the same space, For example, you can now see its services and plans via the `cf marketplace` command. You can use the new services as regular services in Cloud Foundry.
3. Create instance of the service from "Market Place" of Cloud Foundry space consumer subscriber subaccount of BTP
    - Navigate to Consumer subaccount >> *Cloud Foundry space* >> *Service Marketplace* and search for the service broker with service name given as service description given in  [catalog.json](../Applications/author-readings-mt/broker/catalog.json)
    - Create an instance of the service broker by clicking on the three dots 
    - Select *Create* option
        - In the creation window select the *Service* and *Plan* details from dropdown
        - Enter the arbitary *Instance Name*   
        - Click on *Next* 
        - Click on the *Create* button 
        > Note: the service broker instance should be created successfully in subscriber subaccount
    - Navigate to *Services* >> *Instances* look for the newly created service broker instance 
    - Create a *Service Key* for the new service broker instance
        - Click on *Create* button in the *Service Keys* section
        - Enter arbitary *Service Key Name* 
        - Click on *Create* button
        > Note: the service key for the service broker instance should be created successfully
        - Click on the above created *Service Key*, copy the details *clientid*, *clientsecret*, *url*, *apiurl* , the details are used in next step to call the APIs from consumer application like Postman .
4. Access the service from Postman
    - Try accessing the Odata services of BTP application using Oauth authentication from postman.
    - Details of Postman service calls:
        - GET the access token specific to the subscriber subaccount
        - Sample URL: GET `https://armt-s1.authentication.eu10.hana.ondemand.com/oauth/token?grant_type=client_credentials&response_type=token`
        > Note: *Params* -> *grant_type* = *client_credentials* and *response_type* = *token*
        > Note: *Authorization* type is *Basic Auth* -> *UserName* = *clientid* (copied from previous step) and *Password* = *clientsecret* (copied from previous step)
        > Note: copy the *access_token* from response of above GET call and use it as *Token* in the next step
        - Call inbound API Odata services of BTP application using the *Token* obtained from previous step , service call gets the data from specific subaccount tenant instance 
        - Sample service call : GET `https://armt-runtime-srv.cfapps.eu10.hana.ondemand.com/authorreadingmanager/$metadata`
        > Note: in the above service call use the *Authorization* Type as *Bearer Token* , with the *Token* from previous GET response.